{"cells":[{"cell_type":"markdown","metadata":{"id":"JKpjtAMv6gp0"},"source":["# Load Data"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":19678,"status":"ok","timestamp":1709731849888,"user":{"displayName":"Qixin Lin","userId":"13359034810782683417"},"user_tz":360},"id":"7ltEJe18u_mH","outputId":"14572bc8-9579-4159-943f-085943c2aedd"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"xndXpgSuvIAz"},"outputs":[],"source":["import sqlite3\n","import pandas as pd\n","\n","# Connect to database\n","conn = sqlite3.connect('/content/drive/MyDrive/finalproj-organizedData.sqlite3')\n","\n","query = \"\"\"\n","SELECT * FROM StoryHeaders\n","WHERE StoryHeaders.language = 1\n","AND StoryHeaders.title IS NOT NULL\n","AND StoryHeaders.description IS NOT NULL;\n","\"\"\"\n","\n","# Turn it to dataframe\n","df = pd.read_sql_query(query, conn)\n","\n","conn.close()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ckNxjt9Z8mCM"},"outputs":[],"source":["df = df.query('description != \"\"')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":260,"status":"ok","timestamp":1709731859409,"user":{"displayName":"Qixin Lin","userId":"13359034810782683417"},"user_tz":360},"id":"lGdAWOAkyaA2","outputId":"55cf988d-b28b-4cd1-b948-c93178db955c"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["(210733, 19)"]},"metadata":{},"execution_count":4}],"source":["df.shape"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"executionInfo":{"elapsed":362,"status":"ok","timestamp":1709731861411,"user":{"displayName":"Qixin Lin","userId":"13359034810782683417"},"user_tz":360},"id":"HtyFLq1x6ayX","outputId":"6a9b61f9-3c49-4c67-897c-d496d5daaf41"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["     id          processDate  rating  finished  \\\n","0    42  2020-07-29 21:38:01      -1         1   \n","1    63  2020-07-29 21:35:52       2         1   \n","2    84  2020-07-29 21:38:01       0         1   \n","3   168  2020-07-29 21:38:02       0         1   \n","4   210  2020-07-29 21:38:02       1         1   \n","5   252  2020-07-29 21:38:02       1         1   \n","6   273  2020-07-29 21:38:02       1         1   \n","7   294  2020-07-29 21:38:02       0         1   \n","8   336  2020-07-29 21:38:02       3         1   \n","9   357  2020-07-29 21:38:02       1         1   \n","10  378  2020-07-29 21:38:02       0         1   \n","11  420  2020-07-29 21:38:02       0         1   \n","12  441  2020-07-29 21:38:02       1         1   \n","13  462  2020-07-29 21:38:02      -1         0   \n","14  546  2020-07-29 21:38:03       2         1   \n","\n","                                                title  \\\n","0   You can't put back a petal when it falls from ...   \n","1                       The Education of Rodney McKay   \n","2                                         Black Pearl   \n","3           Ring Out the Bells (The Fatherland Remix)   \n","4                                      Things to Come   \n","5                                 Childhood Treasures   \n","6                                         pitch black   \n","7                           Resurrection in Ten Parts   \n","8                                   Nobody's Birthday   \n","9                                         Expatriates   \n","10                                        Daily Grind   \n","11                            Last Will and Testament   \n","12                                       Jungle Fever   \n","13                          The measure of all things   \n","14                  So Let Us Melt, and Make No Noise   \n","\n","                                          description  curChapters  \\\n","0   Cristina gets a haircut. Meredith gets a revel...            1   \n","1   Sometimes life just seemed to happen to Rodney...            1   \n","2   Black pearls are rare and precious—sometimes e...            1   \n","3   She was flushed from exertion, a riot of tangl...            1   \n","4   \"How the hell did you get in here?\" Matt asked...            1   \n","5   \"She isn't quite sure what they're waiting for...            1   \n","6   One hundred and seventeen words of funny naugh...            1   \n","7                      John comes back from the dead.            1   \n","8   In which there are seasons and bicycles and re...            1   \n","9   This is the beginning of a beautiful friendshi...            1   \n","10                        John Winchester, post-2.01.            1   \n","11  Silly little gen ficlet for counterfeitcoin, b...            1   \n","12  Trapped deep in the Congo, Rodney McKay must r...            1   \n","13                        More things begin than end.            1   \n","14  \"You kill patients all the time,\" House said. ...            1   \n","\n","    maxChapters  language  words  hits  kudos  comments  bookmarks  \\\n","0             1         1   2578  3490    239         6         30   \n","1             1         1   2260  1436     96         4         11   \n","2             1         1   1145   883      9         2          1   \n","3             1         1    797   418      4         1          0   \n","4             1         1   1911  3101    129         0          6   \n","5             1         1   1094  2942    201        21         27   \n","6             1         1    118  1179     63         2          0   \n","7             1         1   1603  1290     27         2          6   \n","8             1         1   5090   263      7         0          0   \n","9             1         1   1145   597     17         3          3   \n","10            1         1   1237   469      5         2          0   \n","11            1         1    471   701     15         4          2   \n","12            1         1   8887  2218    106         1         13   \n","13           -1         1    707   169      2         0          0   \n","14            1         1   2059  2199     89        10         20   \n","\n","          date  restricted  headerScrapedFrom  contentScrapedFrom  hidden  \n","0   2008-07-14           0           26262435            26262435       0  \n","1   2008-09-16           0           26262449            26262449       0  \n","2   2008-09-16           0           26262466            26262466       0  \n","3   2008-09-17           0           26262511            26262511       0  \n","4   2008-09-17           0           26262536            26262536       0  \n","5   2005-12-15           0           26262573            26262573       0  \n","6   2005-11-09           0           26262594            26262594       0  \n","7   2008-09-17           0           26262612            26262612       0  \n","8   2008-09-17           0           26262646            26262646       0  \n","9   2007-10-13           0           26262665            26262665       0  \n","10  2007-02-11           0           26262685            26262685       0  \n","11  2008-06-03           0           26262707            26262707       0  \n","12  2008-09-18           0           26262720            26262720       0  \n","13  2007-10-27           0           26262740            26262740       0  \n","14  2007-11-26           0           26262783            26262783       0  "],"text/html":["\n","  <div id=\"df-b489176b-b751-41dd-bcd0-e7cbeebdd4f8\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>id</th>\n","      <th>processDate</th>\n","      <th>rating</th>\n","      <th>finished</th>\n","      <th>title</th>\n","      <th>description</th>\n","      <th>curChapters</th>\n","      <th>maxChapters</th>\n","      <th>language</th>\n","      <th>words</th>\n","      <th>hits</th>\n","      <th>kudos</th>\n","      <th>comments</th>\n","      <th>bookmarks</th>\n","      <th>date</th>\n","      <th>restricted</th>\n","      <th>headerScrapedFrom</th>\n","      <th>contentScrapedFrom</th>\n","      <th>hidden</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>42</td>\n","      <td>2020-07-29 21:38:01</td>\n","      <td>-1</td>\n","      <td>1</td>\n","      <td>You can't put back a petal when it falls from ...</td>\n","      <td>Cristina gets a haircut. Meredith gets a revel...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2578</td>\n","      <td>3490</td>\n","      <td>239</td>\n","      <td>6</td>\n","      <td>30</td>\n","      <td>2008-07-14</td>\n","      <td>0</td>\n","      <td>26262435</td>\n","      <td>26262435</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>63</td>\n","      <td>2020-07-29 21:35:52</td>\n","      <td>2</td>\n","      <td>1</td>\n","      <td>The Education of Rodney McKay</td>\n","      <td>Sometimes life just seemed to happen to Rodney...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2260</td>\n","      <td>1436</td>\n","      <td>96</td>\n","      <td>4</td>\n","      <td>11</td>\n","      <td>2008-09-16</td>\n","      <td>0</td>\n","      <td>26262449</td>\n","      <td>26262449</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>84</td>\n","      <td>2020-07-29 21:38:01</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>Black Pearl</td>\n","      <td>Black pearls are rare and precious—sometimes e...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1145</td>\n","      <td>883</td>\n","      <td>9</td>\n","      <td>2</td>\n","      <td>1</td>\n","      <td>2008-09-16</td>\n","      <td>0</td>\n","      <td>26262466</td>\n","      <td>26262466</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>168</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>Ring Out the Bells (The Fatherland Remix)</td>\n","      <td>She was flushed from exertion, a riot of tangl...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>797</td>\n","      <td>418</td>\n","      <td>4</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>2008-09-17</td>\n","      <td>0</td>\n","      <td>26262511</td>\n","      <td>26262511</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>210</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>Things to Come</td>\n","      <td>\"How the hell did you get in here?\" Matt asked...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1911</td>\n","      <td>3101</td>\n","      <td>129</td>\n","      <td>0</td>\n","      <td>6</td>\n","      <td>2008-09-17</td>\n","      <td>0</td>\n","      <td>26262536</td>\n","      <td>26262536</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>252</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>Childhood Treasures</td>\n","      <td>\"She isn't quite sure what they're waiting for...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1094</td>\n","      <td>2942</td>\n","      <td>201</td>\n","      <td>21</td>\n","      <td>27</td>\n","      <td>2005-12-15</td>\n","      <td>0</td>\n","      <td>26262573</td>\n","      <td>26262573</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>273</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>pitch black</td>\n","      <td>One hundred and seventeen words of funny naugh...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>118</td>\n","      <td>1179</td>\n","      <td>63</td>\n","      <td>2</td>\n","      <td>0</td>\n","      <td>2005-11-09</td>\n","      <td>0</td>\n","      <td>26262594</td>\n","      <td>26262594</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>294</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>Resurrection in Ten Parts</td>\n","      <td>John comes back from the dead.</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1603</td>\n","      <td>1290</td>\n","      <td>27</td>\n","      <td>2</td>\n","      <td>6</td>\n","      <td>2008-09-17</td>\n","      <td>0</td>\n","      <td>26262612</td>\n","      <td>26262612</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>336</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>3</td>\n","      <td>1</td>\n","      <td>Nobody's Birthday</td>\n","      <td>In which there are seasons and bicycles and re...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>5090</td>\n","      <td>263</td>\n","      <td>7</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2008-09-17</td>\n","      <td>0</td>\n","      <td>26262646</td>\n","      <td>26262646</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>357</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>Expatriates</td>\n","      <td>This is the beginning of a beautiful friendshi...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1145</td>\n","      <td>597</td>\n","      <td>17</td>\n","      <td>3</td>\n","      <td>3</td>\n","      <td>2007-10-13</td>\n","      <td>0</td>\n","      <td>26262665</td>\n","      <td>26262665</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>10</th>\n","      <td>378</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>Daily Grind</td>\n","      <td>John Winchester, post-2.01.</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1237</td>\n","      <td>469</td>\n","      <td>5</td>\n","      <td>2</td>\n","      <td>0</td>\n","      <td>2007-02-11</td>\n","      <td>0</td>\n","      <td>26262685</td>\n","      <td>26262685</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>11</th>\n","      <td>420</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>Last Will and Testament</td>\n","      <td>Silly little gen ficlet for counterfeitcoin, b...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>471</td>\n","      <td>701</td>\n","      <td>15</td>\n","      <td>4</td>\n","      <td>2</td>\n","      <td>2008-06-03</td>\n","      <td>0</td>\n","      <td>26262707</td>\n","      <td>26262707</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>441</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>Jungle Fever</td>\n","      <td>Trapped deep in the Congo, Rodney McKay must r...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>8887</td>\n","      <td>2218</td>\n","      <td>106</td>\n","      <td>1</td>\n","      <td>13</td>\n","      <td>2008-09-18</td>\n","      <td>0</td>\n","      <td>26262720</td>\n","      <td>26262720</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>13</th>\n","      <td>462</td>\n","      <td>2020-07-29 21:38:02</td>\n","      <td>-1</td>\n","      <td>0</td>\n","      <td>The measure of all things</td>\n","      <td>More things begin than end.</td>\n","      <td>1</td>\n","      <td>-1</td>\n","      <td>1</td>\n","      <td>707</td>\n","      <td>169</td>\n","      <td>2</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2007-10-27</td>\n","      <td>0</td>\n","      <td>26262740</td>\n","      <td>26262740</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>546</td>\n","      <td>2020-07-29 21:38:03</td>\n","      <td>2</td>\n","      <td>1</td>\n","      <td>So Let Us Melt, and Make No Noise</td>\n","      <td>\"You kill patients all the time,\" House said. ...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2059</td>\n","      <td>2199</td>\n","      <td>89</td>\n","      <td>10</td>\n","      <td>20</td>\n","      <td>2007-11-26</td>\n","      <td>0</td>\n","      <td>26262783</td>\n","      <td>26262783</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b489176b-b751-41dd-bcd0-e7cbeebdd4f8')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-b489176b-b751-41dd-bcd0-e7cbeebdd4f8 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-b489176b-b751-41dd-bcd0-e7cbeebdd4f8');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-cff236d5-15e7-489e-859e-b967c36fac4b\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-cff236d5-15e7-489e-859e-b967c36fac4b')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-cff236d5-15e7-489e-859e-b967c36fac4b button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"df"}},"metadata":{},"execution_count":5}],"source":["df.head(15)"]},{"cell_type":"markdown","metadata":{"id":"uYIo4LSxkc6i"},"source":["# Theme Classification by ChatGPT - get theme for every fan-fiction based on title and discription"]},{"cell_type":"code","source":["# df.rename(columns={'title': 'song_title', 'description': 'lyrics', 'id': 'song'}, inplace=True)"],"metadata":{"id":"TVGwGuezbljt"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["While executing the code for analysis and presentation purposes, I initially adapted the code to accommodate the dataframe's column structure (use the df.rename above). However, prior to submitting the code to my repository, I revised the code to be consistent with the original dataframe. As a result, there may be some discrepancies between the output and the adjusted code."],"metadata":{"id":"cITBj5LFcVPV"}},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":10305,"status":"ok","timestamp":1709731874416,"user":{"displayName":"Qixin Lin","userId":"13359034810782683417"},"user_tz":360},"id":"e5e8rrltw3NB","outputId":"bd36106a-3b5b-4c7a-e52c-57db488d5b8d"},"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting openai\n","  Downloading openai-1.13.3-py3-none-any.whl (227 kB)\n","\u001b[?25l     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m0.0/227.4 kB\u001b[0m \u001b[31m?\u001b[0m eta \u001b[36m-:--:--\u001b[0m\r\u001b[2K     \u001b[91m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m\u001b[90m╺\u001b[0m\u001b[90m━━━\u001b[0m \u001b[32m204.8/227.4 kB\u001b[0m \u001b[31m5.8 MB/s\u001b[0m eta \u001b[36m0:00:01\u001b[0m\r\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m227.4/227.4 kB\u001b[0m \u001b[31m4.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: anyio<5,>=3.5.0 in /usr/local/lib/python3.10/dist-packages (from openai) (3.7.1)\n","Requirement already satisfied: distro<2,>=1.7.0 in /usr/lib/python3/dist-packages (from openai) (1.7.0)\n","Collecting httpx<1,>=0.23.0 (from openai)\n","  Downloading httpx-0.27.0-py3-none-any.whl (75 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m75.6/75.6 kB\u001b[0m \u001b[31m9.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: pydantic<3,>=1.9.0 in /usr/local/lib/python3.10/dist-packages (from openai) (2.6.3)\n","Requirement already satisfied: sniffio in /usr/local/lib/python3.10/dist-packages (from openai) (1.3.1)\n","Requirement already satisfied: tqdm>4 in /usr/local/lib/python3.10/dist-packages (from openai) (4.66.2)\n","Requirement already satisfied: typing-extensions<5,>=4.7 in /usr/local/lib/python3.10/dist-packages (from openai) (4.10.0)\n","Requirement already satisfied: idna>=2.8 in /usr/local/lib/python3.10/dist-packages (from anyio<5,>=3.5.0->openai) (3.6)\n","Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anyio<5,>=3.5.0->openai) (1.2.0)\n","Requirement already satisfied: certifi in /usr/local/lib/python3.10/dist-packages (from httpx<1,>=0.23.0->openai) (2024.2.2)\n","Collecting httpcore==1.* (from httpx<1,>=0.23.0->openai)\n","  Downloading httpcore-1.0.4-py3-none-any.whl (77 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m77.8/77.8 kB\u001b[0m \u001b[31m10.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting h11<0.15,>=0.13 (from httpcore==1.*->httpx<1,>=0.23.0->openai)\n","  Downloading h11-0.14.0-py3-none-any.whl (58 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m58.3/58.3 kB\u001b[0m \u001b[31m5.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: annotated-types>=0.4.0 in /usr/local/lib/python3.10/dist-packages (from pydantic<3,>=1.9.0->openai) (0.6.0)\n","Requirement already satisfied: pydantic-core==2.16.3 in /usr/local/lib/python3.10/dist-packages (from pydantic<3,>=1.9.0->openai) (2.16.3)\n","Installing collected packages: h11, httpcore, httpx, openai\n","Successfully installed h11-0.14.0 httpcore-1.0.4 httpx-0.27.0 openai-1.13.3\n"]}],"source":["! pip install openai"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"oQB2I-J_wjVl"},"outputs":[],"source":["from openai import OpenAI"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Lkw2ogE8w5qz"},"outputs":[],"source":["with open('/content/drive/MyDrive/Key4CoLab.txt', 'r') as file:\n","    openai_api_key = file.read()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"uF3uJ5WNw9A6"},"outputs":[],"source":["client = OpenAI(\n","    api_key=openai_api_key,\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"_xB-DIo2lQSh"},"outputs":[],"source":["themes = [\n","         \"Found Family\",\n","         \"Redemption\",\n","         \"Coming of Age\",\n","         \"Forbidden Love\",\n","         \"Survival\",\n","         \"Identity and Self-Discovery\",\n","         \"Adventure and Exploration\",\n","         \"Power and Corruption\",\n","         \"Betrayal and Revenge\",\n","         \"Time Travel and Alternate Universes\",\n","         \"Mystery and Suspense\",\n","         \"Heroism and Sacrifice\",\n","         \"Friendship and Loyalty\",\n","         \"Transformation and Change\"\n","         \"Morality and Ethics\",\n","         \"Tragedy and Loss\",\n","         \"Science Fiction and Fantasy\",\n","         \"Romantic Comedy\",\n","         \"Psychological Thriller\",\n","         \"Cultural and Social Commentary\"\n","]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6HJz2l894eW1"},"outputs":[],"source":["themes = [\n","         \"Slow Burn Romance\",\n","         \"Enemies to Lovers\",\n","         \"Friends to Lovers\",\n","         \"Soulmates/Fated Love\",\n","         \"Forbidden Love\",\n","         \"Alternative Universe (AU)\",\n","         \"Time Travel/Rewriting History\",\n","         \"Angst with a Happy Ending\",\n","         \"Fluff\",\n","         \"Hurt/Comfort\",\n","         \"Supernatural/Fantasy Elements\",\n","         \"Cross-Over\",\n","         \"Polyamory\",\n","         \"Domestic Life\",\n","]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fdZt9zed6NUi"},"outputs":[],"source":["# This theme categories fit better!\n","\n","themes = [\n","         \"Comedy & Humor\",\n","         \"Slice of Life\",\n","         \"Feel-Good Friendship\",\n","         \"Romantic Fluff\",\n","         \"Uplifting & Inspirational\",\n","         \"Fantasy & Whimsy\",\n","         \"Adventure & Exploration\",\n","         \"Angst & Drama\",\n","         \"Horror & Supernatural\",\n","         \"Tragedy & Loss\",\n","         \"Psychological Thriller\",\n","         \"Dystopian & Apocalyptic\",\n","         \"Crime & Mystery\",\n","         \"Betrayal & Revenge\",\n","         \"Dark Romance\"\n","]"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3,"status":"ok","timestamp":1709731876037,"user":{"displayName":"Qixin Lin","userId":"13359034810782683417"},"user_tz":360},"id":"zgnyJJQwuBNT","outputId":"02c188c7-d7e2-420b-d1ef-c9046620e66a"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["['Adventure & Exploration',\n"," 'Angst & Drama',\n"," 'Betrayal & Revenge',\n"," 'Comedy & Humor',\n"," 'Crime & Mystery',\n"," 'Dark Romance',\n"," 'Dystopian & Apocalyptic',\n"," 'Fantasy & Whimsy',\n"," 'Feel-Good Friendship',\n"," 'Horror & Supernatural',\n"," 'Psychological Thriller',\n"," 'Romantic Fluff',\n"," 'Slice of Life',\n"," 'Tragedy & Loss',\n"," 'Uplifting & Inspirational']"]},"metadata":{},"execution_count":11}],"source":["# rank the themes in alphabetical order\n","themes.sort()\n","themes"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"LXqcrY4_u4BK"},"outputs":[],"source":["import time\n","import random\n","\n","def tag_descripitions_with_theme(row, themes):\n","    id = row['id']\n","    title = row['title']\n","    description = row['description']\n","    theme_list = \", \".join(themes)\n","\n","    messages = [\n","        {\"role\": \"system\", \"content\": f\"\"\"\n","        Read the description of the fan-fiction titled '{title}'. Based on the content and emotions expressed in the description,\n","        identify the MOST relevant ONE theme of the following themes are represented:\n","        *** {theme_list} ***.\n","\n","        Please select and respond with the ONE MOST relevant themes from the above list.\n","        In your respond, only include words from the themes given above.\n","        \"\"\"},\n","        {\"role\": \"user\", \"content\": description}\n","    ]\n","\n","    attempt = 0\n","    max_attempts = 10\n","    delay = 2.0  # Starting delay is 2 second\n","    max_delay = 64.0  # Maximum delay\n","    backoff_factor = 2  # Exponential growth factor\n","\n","    while attempt < max_attempts:\n","        try:\n","            # Send the query to OpenAI's GPT-3.5 using the chat model\n","            response = client.chat.completions.create(\n","                model=\"gpt-3.5-turbo\",\n","                messages=messages,\n","                max_tokens=1024,\n","                temperature=0.7,\n","            )\n","            # Extracting the relevant part of the response\n","            themes_identified = response.choices[0].message.content.strip()\n","\n","            return id, themes_identified\n","\n","        except Exception as e:\n","            print(f\"Attempt {attempt + 1}: API request failed, retrying in {delay} seconds...\")\n","            time.sleep(delay)\n","            attempt += 1\n","            delay = min(max_delay, delay * backoff_factor + random.uniform(0, 1))  # Increase delay\n","            if attempt == max_attempts:\n","                print(f\"Maximum attempts reached for id: {id}\")\n","                return id, \"Failed to identify themes due to API rate limits\""]},{"cell_type":"code","execution_count":null,"metadata":{"id":"dBH-BB5c7D8E"},"outputs":[],"source":["import pandas as pd\n","import json\n","from tqdm import tqdm\n","from concurrent.futures import ThreadPoolExecutor, as_completed\n","import time\n","\n","def tag_descripitions_with_themes(df, themes, workers=10):\n","    output_folder_path = '/content/drive/MyDrive/theme/'\n","\n","    rows_per_batch = 400  # Based on the rate limit\n","    total_rows = len(df)\n","    num_batches = (total_rows + rows_per_batch - 1) // rows_per_batch  # Ceiling division\n","\n","    for batch_num in range(281, num_batches):\n","        start_index = batch_num * rows_per_batch\n","        end_index = min(start_index + rows_per_batch, total_rows)\n","        batch_df = df.iloc[start_index:end_index]\n","        output_file_path = f\"{output_folder_path}descriptions_themes_batch_{batch_num+1}.json\"  # Naming each batch file uniquely\n","\n","        with open(output_file_path, 'w') as outfile, ThreadPoolExecutor(max_workers=workers) as executor:\n","            future_to_id = {executor.submit(tag_descriptions_with_theme, row, themes): row['id'] for _, row in batch_df.iterrows()}\n","\n","            for future in tqdm(as_completed(future_to_id), total=len(batch_df), desc=f\"Tagging themes, batch {batch_num+1}/{num_batches}\"):\n","                title = future_to_id[future]\n","                try:\n","                    title, themes_identified = future.result()\n","                    theme_json = json.dumps({id_title: themes_identified})\n","                    outfile.write(theme_json + '\\n')\n","                except Exception as exc:\n","                    print(f'{title} generated an exception: {exc}')\n","\n","        if batch_num < num_batches - 1:  # Avoid sleeping after the last batch\n","            print(\"Pausing for rate limit - waiting 60 seconds before the next batch...\")\n","            time.sleep(30)\n","\n","    print(\"All themes tagged and saved.\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"N6k_vvAKwS28"},"outputs":[],"source":["sample_drop = df.sample(100)\n","\n","tag_descriptions_with_themes(sample_drop, themes, workers=20)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","output_embedded_package_id":"16ron9uGHPQ1p2DlBF1vDlHsGHpG_GHmK"},"id":"nZHLU6dTwTY7","outputId":"9759106a-581b-4844-89f1-4abb633367de","executionInfo":{"status":"ok","timestamp":1709753205596,"user_tz":360,"elapsed":6731245,"user":{"displayName":"Qixin Lin","userId":"13359034810782683417"}}},"outputs":[{"output_type":"display_data","data":{"text/plain":"Output hidden; open in https://colab.research.google.com to view."},"metadata":{}}],"source":["# operate fully on the entire dataframe\n","# maybe need several hours and 10+ dollars\n","\n","tag_descriptions_with_themes(df, themes, workers=40)"]}],"metadata":{"colab":{"provenance":[],"collapsed_sections":["JKpjtAMv6gp0"],"authorship_tag":"ABX9TyO0A6PX/jBe8I7OniSpyc+B"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}